
{% extends "base.html" %}
{% load static %}
{% load humanize %}
{% block content %}

<link rel="stylesheet" href="{% static 'book_cover.css' %}"></style>
    

<h1 class="px-3 pt-3 fw-bold">Book Library</h1>

<!-- Search Bar -->
<div class="search-container">
    <form method="GET" class="search-form d-flex gap-2 align-items-center flex-wrap">
           <input 
                type="text" 
                name="q" 
                class="search-input" 
                placeholder="Search books by title, author, or publisher..." 
                value="{{ request.GET.q|default_if_none:'' }}"
                autocomplete="off"
            >
        <select name="sort" class="sort-select form-select" style="max-width: 200px;">
            <option value="" {% if not request.GET.sort %}selected{% endif %}>Sort by</option>
            <option value="cost_asc" {% if request.GET.sort == 'cost_asc' %}selected{% endif %}>Cost: Low to High</option>
            <option value="cost_desc" {% if request.GET.sort == 'cost_desc' %}selected{% endif %}>Cost: High to Low</option>
            <option value="downloads_asc" {% if request.GET.sort == 'downloads_asc' %}selected{% endif %}>Downloads: Low to High</option>
            <option value="downloads_desc" {% if request.GET.sort == 'downloads_desc' %}selected{% endif %}>Downloads: High to Low</option>
            <option value="page_count_asc" {% if request.GET.sort == 'page_count_asc' %}selected{% endif %}>Page Count: Low to High</option>
            <option value="page_count_desc" {% if request.GET.sort == 'page_count_desc' %}selected{% endif %}>Page Count: High to Low</option>
            <option value="title_asc" {% if request.GET.sort == 'title_asc' %}selected{% endif %}>Title: A to Z</option>
            <option value="title_desc" {% if request.GET.sort == 'title_desc' %}selected{% endif %}>Title: Z to A</option>
        </select>

        <button type="submit" class="search-btn">Search</button>
        {% if request.GET.q %}
            <a href="{% url 'book_list' %}" class="clear-btn">Clear</a>
        {% endif %}
    </form>
    

<!-- Book List -->
<div class="book-list">
    {% if books %}
        {% for book in books %}
        <div class="book-item">
            <div class="book-cover"><a href="{% url 'book_detail' book.id %}">
                {% if book.cover_image %}
                    <img src="{{ book.cover_image }}" alt="{{ book.title }} cover">
                {% else %}
                    <div class="book-placeholder" data-book-id="{{ book.id }}">
                        {{book.title}}
                    </div>
                {% endif %}
                </a>
            </div>
            
            <div class="book-details">
                <h3>
                    <a class="link-dark link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{% url 'book_detail' book.id %}">
                    {{ book.title}}
                    </a>
                </h3>
                <p class="authors">
                    {% if book.authors.all.0.first_name != "Anonymous" %}
                        by
                        {% for author in book.authors.all %}
                            {{ author.first_name }} {{ author.last_name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% endif %}
                </p>
                <p><strong>Publisher:</strong> {{ book.publisher }}</p>
                <p><strong>Pages:</strong> {{ book.page_count }}</p>
                <p style="color: #2a9d8f;">${{ book.cost|floatformat:2 }}</p>
                <p>{{ book.downloads|intcomma }} Downloads</p>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="no-results">
            {% if request.GET.q %}
                No books found matching your search.
            {% else %}
                No books available.
            {% endif %}
        </div>
    {% endif %}
</div>

 <nav aria-label="...">
    <ul class="pagination">
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query|urlencode }}&{% endif %}page=1">&laquo; first</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query|urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">previous</a>
            </li>
        {% endif %}
        
        <li class="page-item active">
            <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
        </li>
        
        {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query|urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">next</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?{% if query %}q={{ query|urlencode }}&{% endif %}page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            </li>
        {% endif %}
    </ul>
</nav>

<script src="{% static 'book_cover.js' %}"></script>


{% endblock %}